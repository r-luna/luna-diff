!function(t){"use strict";var l,o,r,f,d,g,u=13,s="#ff00ff",y=5,c=!1,x=.1,w=.5;function m(h){return new Promise(function(t,e){var i=new Image;i.onload=function(){t(this)},i.onerror=function(t){e(t)},i.src=h})}t.init=function(t,e,i,h){var n=performance.now(),a=null;r=document.createElement("canvas"),f=document.createElement("canvas"),d=r.getContext("2d"),g=f.getContext("2d"),u=h.prox||u,s=h.color||s,y=h.diffThreshold||y,c=h.drawBoundingBoxFlag||c,x=h.ctx1Alpha||x,w=h.ctx2Alpha||w,m(t).then(function(t){return l=t,m(e)}).then(function(t){o=t}).then(function(){if(a=performance.now(),l.width===o.width){var t,e=null;r.setAttribute("height",l.height),r.setAttribute("width",l.width),f.setAttribute("height",o.height),f.setAttribute("width",o.width),d.drawImage(l,0,0,l.width,l.height),g.drawImage(o,0,0,o.width,o.height),function(t){for(var e=0;e<t.length;e++)d.globalAlpha=x,d.fillStyle=s,d.fillRect(t[e].x-1,t[e].y-1,2,2),g.globalAlpha=w,g.fillStyle=s,g.fillRect(t[e].x-.5,t[e].y-.5,.5,.5)}(t=function(t,e){for(var i,h,n,a,l,o,r,f,d=t.width,g=(t.height,[]),u=0,s=0,c=t.data.length,x=0;x<c;x+=4)x/4%d?s++:(s=0,u++),i=t.data[x],h=t.data[x+1],n=t.data[x+2],a=t.data[x+3],l=e.data[x],o=e.data[x+1],r=e.data[x+2],f=e.data[x+3],Math.abs(i-l)>y?g.push({x:s,y:u}):Math.abs(h-o)>y?g.push({x:s,y:u}):Math.abs(n-r)>y?g.push({x:s,y:u}):Math.abs(a-f)>y&&g.push({x:s,y:u});return g}(d.getImageData(0,0,r.width,r.height),g.getImageData(0,0,f.width,f.height))),c&&function(t){for(var e={x:null,y:null},i={x:null,y:null},h=0;h<t.length;h++)t[h].sort(function(t,e){return t.x<e.x?-1:t.x>e.x?1:0}),e.x=t[h][0].x||0,i.x=t[h][t[h].length-1].x,t[h].sort(function(t,e){return t.y<e.y?-1:t.y>e.y?1:0}),e.y=t[h][0].y||0,i.y=t[h][t[h].length-1].y,d.globalAlpha=1,d.strokeStyle="#ff0000",d.lineWidth=1,d.beginPath(),d.moveTo(e.x-5,e.y-5),d.lineTo(i.x+5,e.y-5),d.lineTo(i.x+5,i.y+5),d.lineTo(e.x-5,i.y+5),d.closePath(),d.stroke(),g.globalAlpha=1,g.strokeStyle="#ff0000",g.lineWidth=1,g.beginPath(),g.moveTo(e.x-5,e.y-5),g.lineTo(i.x+5,e.y-5),g.lineTo(i.x+5,i.y+5),g.lineTo(e.x-5,i.y+5),g.closePath(),g.stroke()}(e=function(t){var e=[],i=u,h=!1;for(e.push([t[0]]),t.splice(0,1);0!==t.length;){for(var n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)if(Math.abs(t[0].x-e[n][a].x)<=i){if(Math.abs(t[0].y-e[n][a].y)<=i){e[n].push(t[0]),t.splice(0,1),h=!0;break}}else if(Math.abs(t[0].y-e[n][a].y)<=i&&Math.abs(t[0].x-e[n][a].x)<=i){e[n].push(t[0]),t.splice(0,1),h=!0;break}if(0===t.length)break}h||(e.push([t[0]]),t.splice(0,1)),h=!1}return e}(t)),a=performance.now(),i({img1:{height:l.height,width:l.width},img2:{height:o.height,width:o.width},proximitySetting:u,diffThreshold:y,diffQuan:e?e.length:null,analysisTime:a-n,isSameDimensions:l.width===o.width&&l.height===o.height,dimensionDifference:{height:l.height-o.height,width:l.width-o.width},err:null,diff1:r.toDataURL(),diff2:f.toDataURL()}),l=o=r=f=d=g=null}else i({img1:{height:l.height,width:l.width},img2:{height:o.height,width:o.width},proximitySetting:u,diffQuan:null,executionTime:a-n,err:"images are of unequal width"})})}}(this.lunadiff=this.lunadiff||{});